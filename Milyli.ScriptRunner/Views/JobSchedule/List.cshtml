@model ScriptListModel
@using Newtonsoft.Json    
@{
    ViewBag.Title = string.Format("Relativity Script List - {0}", Model.RelativityWorkspace.WorkspaceName);
}

<h2>Relativity Script List</h2>
<div id="script-list">
    <table>
        <thead>
            <tr>
                <th>
                    Script Name
                </th>
                <th>
                    Schedule Count
                </th>
                <th>
                    Next Execution Time
                </th>
                <th>
                </th>
            </tr>
        </thead>
        <tbody data-bind="foreach: RelativityScripts">
            <tr>
                <td data-bind="text: RelativityScript.Name"></td>
                <td data-bind="text: JobScheduleCount"></td>
                <td data-bind="text : NextExecutionTime"></td>
                <td><a data-bind="click : NewSchedule" href="javascript:;" class="fa fa-plus" title="add new schedule"></a></td>
            </tr>
        </tbody>
    </table>
</div>


@section Scripts
{
    <script type="text/javascript">
        var options = {
            extend : {
                "{root}.RelativityScripts[i]" : function(RelativityScript)
                {
                    RelativityScript.NextExecutionTime = ko.computed(function(){
                        if(RelativityScript.JobSchedules && RelativityScript.JobSchedules.length)
                        {
                            return RelativityScript.JobSchedules[0].NextExecutionTime;
                        }
                        return "";
                    }),
                    
                    RelativityScript.JobScheduleCount = ko.computed(function(){
                        if(RelativityScript.JobSchedules && RelativityScript.JobSchedules.length)
                        {
                            return RelativityScript.JobSchedules.length
                        }
                        return 0;
                    })
                    
                    NewSchedule = function(event, data)
                    {
                    }
                }
            }
        };

        var viewmodel = ko.viewmodel.fromModel(@Html.Raw(JsonConvert.SerializeObject(Model)), options);

        ko.applyBindings(viewmodel, $("#script-list")[0]);
    </script>
}